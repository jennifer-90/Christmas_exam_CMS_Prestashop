/**
 * eon.jquery.servicepointer ~ Version 1.65.2
 * @author    Serge Jamasb
 * @copyright the author
 * @license  MIT/GPL
 */
!function(t,e){function n(t){return isNaN(t)?0:t*Math.PI/180}function a(e){var n=t("#tracie");"undefined"===e&&(e="Ready"),0===n.length&&t("#search-form").append('<span id="tracie" style="color: silver;margin-left: 5px;"></span>'),n.text(e)}ServicePointer={icon:{ppoint:"",plocker:"",kariboo:""},lang:{},map:"",a:{},b:[],c:null,services:{get_nearest_service_points:"",get_service_point_hours:"",set_service_point:""},d:{nearest_service_points:{},service_point_hours:{}},e:"",f:"",g:"",h:"",i:!1,is_busy:!1,init:function(t,e,n,a){this.f=a,this.e=e,this.g=t,this.a.pp=this.icon.ppoint,this.a.pl=this.icon.plocker,this.a.kb=this.icon.kariboo;var o={mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:12},i=n.list&&n.list.length&&n.coords.length;i&&(o.center=new google.maps.LatLng(n.coords[0][0],n.coords[0][1])),this.map=new google.maps.Map(document.getElementById("map-canvas"),o),this.geocoder=new google.maps.Geocoder,this.j(),i&&this.k(n)},k:function(e){if(void 0!==e&&(this.c=e),!this.c.list.length||!this.c.coords.length)return a(this.lang["No results found"]);this.l(),this.m();var n=new google.maps.LatLngBounds;t.each(this.c.coords,function(t,e){latLng=new google.maps.LatLng(e[0],e[1]),n.extend(latLng)}),_map=this.map,_map.panToBounds(n),1==this.c.coords.length?this.map.panTo(new google.maps.LatLng(this.c.coords[0][0],this.c.coords[0][1])):setTimeout(function(){_map.fitBounds(n)},600)},j:function(){var e=this;t(document).on("submit","#search-form",function(n){n.preventDefault(),n.stopPropagation();var o=t("#postcode").val().trim(),i=t("#city").val().trim(),s=t("#address1").val().trim(),r=i.toLowerCase()+o,p=e.i;if(e.i=!1,a(""),void 0!==e.d.nearest_service_points[r])return e.k(e.d.nearest_service_points[r]);t.get(e.services.get_nearest_service_points,{postcode:o,city:i,address1:s},function(t){void 0!==t.coords?(e.d.nearest_service_points[r]=t,e.k(t)):p&&a(e.lang["No results found"])})});var n=t("#postcode, #city, #address1");t(document).on("keyup change paste",n,function(){e.i=!0}),t(document).on("click","#poi li .button",function(){var n=t(this).closest("li");t.post(e.services.set_service_point,{service_point_id:n.data("servicepointid"),sp_type:n.data("sptype")},function(n){try{if(parent.$("#form").length||e.e>=1.7&&parent.$("form#js-delivery"))parent.$.fancybox.close();else{var a=0,o=0,i="",s=parent.$(".delivery_option_radio"),r="&";t.each(s,function(e){t(this).prop("checked")&&(r+=parent.$(s[e]).attr("name")+"="+parent.$(s[e]).val()+"&")}),"&"==r&&(r="&delivery_option=&"),parent.$("input#recyclable:checked").length&&(a=1),parent.$("input#gift:checked").length&&(o=1,i=encodeURIComponent(parent.$("#gift_message").val())),t.post(parent.orderOpcUrl,{ajax:!0,gift:o,gift_message:i,id_carrier:parseInt(parent.$('[name="id_carrier"], .delivery_option_radio').filter(":checked").val(),10),method:"updateCarrierAndGetPayments",rand:(new Date).getTime(),recyclable:a},function(n){if(n.hasError){var a="";for(var o in n.errors)"indexOf"!==o&&(a+=t("<div />").html(n.errors[o]).text()+"\n");alert(a)}else parent.updateCartSummary(n.summary),parent.updatePaymentMethods(n),parent.updateHookShoppingCart(n.HOOK_SHOPPING_CART),parent.updateHookShoppingCartExtra(n.HOOK_SHOPPING_CART_EXTRA),parent.$("#opc_delivery_methods-overlay, #opc_payment_methods-overlay").fadeOut("slow"),e.e>1.4&&(parent.updateCarrierList(n.carrier_data),parent.refreshDeliveryOptions());parent.$.fancybox.close()},"JSON")}}catch(t){parent.$("#fancybox-overlay").hide(),parent.$("#fancybox-wrap").hide()}},"JSON")}),t(document).on("click","#poi li",function(n){if(!t(n.target).is(".button")&&!e.is_busy){t(n.target).is("a")&&(n.preventDefault(),n.stopPropagation());var a=t(this),o=a.find(".hours");if(a.siblings().removeClass("active").find(".hours").hide(),a.toggleClass("active"),o.length)o.toggle();else switch(e.f){case 2:if(void 0!==e.d.service_point_hours[a.data("servicepointid")])return e.n(e.d.service_point_hours[a.data("servicepointid")],a);t.get(e.services.get_service_point_hours,{service_point_id:a.data("servicepointid"),sp_type:a.data("sptype")},function(t){t&&(e.d.service_point_hours[a.data("servicepointid")]=t,e.n(t,a))});break;case 4:$button=t("<a />").addClass("button").text(e.lang["Next step"]),t('<div class="hours" />').append($button).insertAfter(a.find("a"))}setTimeout(function(){t("#poi").animate({scrollTop:a.position().top},"500","swing")},800)}}),google.maps.event.addListener(this.map,"dragstart",function(){var t=e.map;e.start_center=t.getCenter()}),google.maps.event.addListener(this.map,"dragend",function(){var n=e.map,o=e.geocoder,i=n.getCenter(),s=!1;o.geocode({latLng:i},function(n,o){if(o==google.maps.GeocoderStatus.OK){var i="",r="",p="",c="",d="",l="";if(n.length){var h=n[0];if(l=h.place_id,t.each(h.address_components,function(t,n){switch(n.types[0]){case"street_number":d=n.short_name;break;case"route":c=n.long_name;break;case"locality":case"administrative_area_level_1":""==p&&(p=n.short_name);break;case"country":if(i=n.short_name,!(s=i===e.g))return!1;break;case"postal_code":r=n.short_name;break;default:return!0}}),s){if("BE"===i){var m=c.length&&d.length?c+" "+d:"";t("#address1").val(m),p.length&&("Vlaanderen"==p?a("Vlaanderen"):t("#city").val(p))}r.length?(t("#postcode").val(r),e.h=l,t("input[name=searchSubmit]").trigger("click")):a("no postcode")}}}}),!s&&e.h.length&&o.geocode({placeId:e.h},function(t,e){e==google.maps.GeocoderStatus.OK&&t.length&&n.panTo(t[0].geometry.location)})})},l:function(){if(this.c.list.length){var e,n=this,a=t("#poi"),o=a.children("li").first().clone();a.empty(),o.removeClass("active hidden"),t.each(this.c.list,function(i,s){e=o.clone(!0),e.data("servicepointid",s.id).attr("data-servicepointid",s.id).data("sptype",s.type).attr("data-sptype",s.type).find("a").attr("title",s.office).click(function(){n.o(i)}).end().find(".icon").attr("src",16&s.type?n.a.kb:4&s.type?n.a.pl:n.a.pp).end().find(".details").empty().append(t("<span />").addClass("name").text(s.office),s.street+" "+s.nr,"<br />",s.zip+" "+s.city).end().find(".hours").remove(),a.append(e)})}},m:function(){var e=this;e.c.coords.length&&(e.p(),t.each(e.c.coords,function(t,n){var a=e.c.list[t].type;setTimeout(function(){e.q(n,a)},50*t)}))},q:function(e,n){var a=this,o=new google.maps.Marker({animation:google.maps.Animation.DROP,icon:16&n?a.a.kb:4&n?a.a.pl:a.a.pp,map:a.map,position:new google.maps.LatLng(e[0],e[1])});a.b.push(o);var i=[];google.maps.event.addListener(o,"click",function(){i.push(parseFloat(o.position.lat().toFixed(5))),i.push(parseFloat(o.position.lng().toFixed(5)));var e,n;for(e=0,n=a.c.coords.length;e<n&&(0!=t(a.c.coords[e]).not(i).length||0!=t(i).not(a.c.coords[e]).length);e++);e<n&&(t(t("#poi li").get(e)).trigger("click"),a.o(e))})},p:function(){var t;for(t=0;t<this.b.length;t++)this.b[t].setMap(null);this.b=[]},o:function(e){var n=this,a=n.b[e],o=google.maps.Animation.BOUNCE;void 0!==a&&null!==a.getAnimation()&&(o=null),t(n.b).each(function(){this.setAnimation(null)}),a.setAnimation(o)},n:function(e,n){var a,o=this,i=t('<div class="hours" />'),s=t("<table />"),r=t("<a />").addClass("button").text(o.lang["Next step"]);e&&(t.each(e,function(e,n){a=t("<tr />"),t.isEmptyObject(n.am_open)||t.isEmptyObject(n.pm_open)?t.isEmptyObject(n.am_open)||t.isEmptyObject(n.pm_close)?t.isEmptyObject(n.am_open)||t.isEmptyObject(n.am_close)||!t.isEmptyObject(n.pm_open)?t.isEmptyObject(n.pm_open)&&t.isEmptyObject(n.pm_close)?a.addClass("two-cols").append('<td class="day">'+o.lang[e]+'</td><td colspan="2">'+o.lang.Closed+"</td>"):a.addClass("two-cols").append('<td class="day">'+o.lang[e]+'</td><td colspan="2">'+n.pm_open+(t.isEmptyObject(n.pm_close)?"":" - "+n.pm_close)+"</td>"):a.addClass("two-cols").append('<td class="day">'+o.lang[e]+'</td><td colspan="2">'+n.am_open+" - "+n.am_close+"</td>"):a.addClass("two-cols").append('<td class="day">'+o.lang[e]+'</td><td colspan="2">'+n.am_open+" - "+n.pm_close+"</td>"):a.append('<td class="day">'+o.lang[e]+"</td><td>"+n.am_open+(t.isEmptyObject(n.am_close)?"":" - "+n.am_close)+"</td><td>"+n.pm_open+(t.isEmptyObject(n.pm_close)?"":" - "+n.pm_close)+"</td>"),s.append(a)}),i.append(s)),i.append(r).insertAfter(n.find("a"))},mapDistance:function(t){if(0==this.start_center.length)return 0;var e=this,n=e.map,a=n.getProjection();return point_prev=a.fromLatLngToPoint(e.start_center),point_now=a.fromLatLngToPoint(t),dist=Math.sqrt(Math.pow(2,point_now.x-point_prev.x)+Math.pow(2,point_now.y-point_prev.y)),dist},distanceMoved:function(t){if(0==this.start_center.length)return 0;var e=this.start_center.lat(),a=this.start_center.lng(),o=t.lat(),i=t.lng(),s=n(e),r=n(o),p=n(o-e)/2,c=n(i-a)/2,d=Math.sin(p)*Math.sin(p)+Math.cos(s)*Math.cos(r)*Math.sin(c)*Math.sin(c);return 2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d))*6371}}}(jQuery);